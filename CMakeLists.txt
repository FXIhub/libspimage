PROJECT (spimage)

IF(WIN32)
	ADD_DEFINITIONS(-D_HDF5USEDLL_)
	ADD_DEFINITIONS( -D_CRT_SECURE_NO_DEPRECATE)
ENDIF(WIN32)

	

FIND_PATH (FFTW_INCLUDE_DIR fftw3.h PATHS /usr/include /sw/include)
FIND_PATH (PNG_INCLUDE_DIR png.h PATHS /usr/include /sw/include)
FIND_PATH (TIFF_INCLUDE_DIR tiff.h PATHS /usr/include /sw/include)
FIND_PATH (HDF5_INCLUDE_DIR hdf5.h PATHS /usr/include /sw/include)

IF(UNIX AND CMAKE_SIZEOF_VOID_P EQUAL 8)
	IF(EXISTS /usr/lib64)
		SET(LIBRARY_SUFFIX 64)
	ENDIF(EXISTS /usr/lib64)
ENDIF(UNIX AND CMAKE_SIZEOF_VOID_P EQUAL 8)

FIND_LIBRARY (TIFF_LIBRARY tiff /usr/lib /sw/lib)
FIND_LIBRARY (PNG_LIBRARY png /usr/lib /sw/lib)
FIND_LIBRARY (FFTW3_LIBRARY fftw3 /usr/lib /sw/lib)
FIND_LIBRARY (HDF5_LIBRARY hdf5 /usr/lib /sw/lib)

IF(WIN32)
ELSE(WIN32)

FIND_LIBRARY (FFTW3F_LIBRARY fftw3f /usr/lib /sw/lib)
FIND_LIBRARY (FFTW3F_THREADS_LIBRARY fftw3f_threads /usr/lib /sw/lib)	
FIND_LIBRARY (PTHREAD_LIBRARY pthread /usr/lib /sw/lib)	
ENDIF(WIN32)

SET(FFTW_LIBRARY ${FFTW3_LIBRARY} ${FFTW3F_LIBRARY} ${FFTW3F_THREADS_LIBRARY} ${PTHREAD_LIBRARY})


INCLUDE_DIRECTORIES(${FFTW_INCLUDE_DIR} ${PNG_INCLUDE_DIR} ${TIFF_INCLUDE_DIR} ${HDF5_INCLUDE_DIR})

ADD_LIBRARY(spimage SHARED image_util.c fft.c)

IF(CMAKE_MAJOR_VERSION GREATER 1)
	IF(CMAKE_MINOR_VERSION GREATER 0)
		INSTALL(TARGETS spimage
	            RUNTIME DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
	            LIBRARY DESTINATION ${CMAKE_INSTALL_PREFIX}/lib${LIBRARY_SUFFIX}
	            ARCHIVE DESTINATION ${CMAKE_INSTALL_PREFIX}/lib${LIBRARY_SUFFIX}/static)
		INSTALL(FILES spimage/fft.h spimage/image_util.h spimage/image.h DESTINATION /usr/include/spimage)
		INSTALL(FILES spimage.h DESTINATION /usr/include/)
	ELSE(CMAKE_MINOR_VERSION GREATER 0)
		INSTALL_FILES(/include/ .h spimage)
		INSTALL_FILES(/include/spimage .h spimage/fft spimage/image_util spimage/image)
		INSTALL_TARGETS(/lib${LIBRARY_SUFFIX} RUNTIME_DIRECTORY/bin spimage)
	ENDIF(CMAKE_MINOR_VERSION GREATER 0)
ENDIF(CMAKE_MAJOR_VERSION GREATER 1)

TARGET_LINK_LIBRARIES(spimage ${TIFF_LIBRARY} ${FFTW_LIBRARY} ${PNG_LIBRARY} ${HDF5_LIBRARY})
